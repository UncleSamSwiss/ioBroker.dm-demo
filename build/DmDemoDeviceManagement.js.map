{
  "version": 3,
  "sources": ["../src/DmDemoDeviceManagement.ts"],
  "sourcesContent": ["import { type DeviceLoadContext, DeviceManagement, type InstanceDetails } from '@iobroker/dm-utils';\nimport { randomUUID } from 'node:crypto';\nimport type { DmDemo } from './main';\n\n/**\n * Device management class for the dm-demo adapter.\n */\nexport class DmDemoDeviceManagement extends DeviceManagement<DmDemo> {\n    protected override async getInstanceInfo(): Promise<InstanceDetails> {\n        const info = await super.getInstanceInfo();\n        info.identifierLabel = 'UUID';\n        info.actions ??= [];\n        info.actions.push(\n            {\n                id: 'add-device',\n                title: 'Add Device',\n                icon: 'add',\n                inputBefore: {\n                    label: 'New device name',\n                    type: 'text',\n                },\n                handler: async (context, options) => {\n                    await this.addDevice(options?.input ?? 'Unnamed Device');\n\n                    return { refresh: true };\n                },\n            },\n            {\n                id: 'add-many',\n                title: 'Add Many Devices',\n                icon: 'forward',\n                inputBefore: {\n                    label: 'Number of new devices',\n                    type: 'number',\n                    min: 0,\n                    max: 100,\n                    step: 1,\n                },\n                handler: async (context, options) => {\n                    const count = Number(options?.input || 0);\n                    if (count == 0) {\n                        await context.showMessage('Please enter a number greater than 0');\n                        return { refresh: false };\n                    }\n\n                    const confirmed = await context.showConfirmation(`Are you sure you want to add ${count} devices?`);\n                    if (!confirmed) {\n                        return { refresh: false };\n                    }\n\n                    const progress = await context.openProgress('Adding devices...', { value: 0 });\n\n                    for (let i = 1; i <= count; i++) {\n                        await delay(200); // Simulate some delay in creating devices\n\n                        await this.addDevice();\n\n                        await progress.update({\n                            value: (i / count) * 100,\n                            label: `Added ${i} of ${count} devices`,\n                        });\n                    }\n\n                    await progress.close();\n\n                    return { refresh: true };\n                },\n            },\n        );\n        return info;\n    }\n\n    protected override async loadDevices(context: DeviceLoadContext<string>): Promise<void> {\n        const devices = await this.adapter.getDevicesAsync();\n        context.setTotalDevices(devices.length + 1);\n\n        for (const device of devices) {\n            context.addDevice({\n                id: device._id,\n                identifier: device.native.uuid,\n                name: {\n                    objectId: device._id,\n                    property: 'common.name',\n                },\n\n                enabled: true,\n            });\n\n            await delay(500); // Simulate some delay in loading devices\n        }\n\n        context.addDevice({\n            id: 'new-device',\n            name: 'Device without state',\n            enabled: false,\n        });\n    }\n\n    private async addDevice(name?: string): Promise<void> {\n        const ts = Date.now();\n        const id = `device-${ts}`;\n        await this.adapter.extendObject(id, {\n            type: 'device',\n            common: {\n                name: name ?? `Device ${ts}`,\n                desc: 'Change the name to see it immediately reflect in the device list',\n            },\n            native: {\n                uuid: randomUUID(),\n            },\n        });\n    }\n}\n\nfunction delay(ms: number): Promise<void> {\n    return new Promise(resolve => setTimeout(resolve, ms));\n}\n"],
  "mappings": ";;;;;;;;;;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,sBAA+E;AAC/E,yBAA2B;AAMpB,MAAM,+BAA+B,iCAAyB;AAAA,EACjE,MAAyB,kBAA4C;AARzE;AASQ,UAAM,OAAO,MAAM,MAAM,gBAAgB;AACzC,SAAK,kBAAkB;AACvB,eAAK,YAAL,iBAAK,UAAY,CAAC;AAClB,SAAK,QAAQ;AAAA,MACT;AAAA,QACI,IAAI;AAAA,QACJ,OAAO;AAAA,QACP,MAAM;AAAA,QACN,aAAa;AAAA,UACT,OAAO;AAAA,UACP,MAAM;AAAA,QACV;AAAA,QACA,SAAS,OAAO,SAAS,YAAY;AArBrD,cAAAA;AAsBoB,gBAAM,KAAK,WAAUA,MAAA,mCAAS,UAAT,OAAAA,MAAkB,gBAAgB;AAEvD,iBAAO,EAAE,SAAS,KAAK;AAAA,QAC3B;AAAA,MACJ;AAAA,MACA;AAAA,QACI,IAAI;AAAA,QACJ,OAAO;AAAA,QACP,MAAM;AAAA,QACN,aAAa;AAAA,UACT,OAAO;AAAA,UACP,MAAM;AAAA,UACN,KAAK;AAAA,UACL,KAAK;AAAA,UACL,MAAM;AAAA,QACV;AAAA,QACA,SAAS,OAAO,SAAS,YAAY;AACjC,gBAAM,QAAQ,QAAO,mCAAS,UAAS,CAAC;AACxC,cAAI,SAAS,GAAG;AACZ,kBAAM,QAAQ,YAAY,sCAAsC;AAChE,mBAAO,EAAE,SAAS,MAAM;AAAA,UAC5B;AAEA,gBAAM,YAAY,MAAM,QAAQ,iBAAiB,gCAAgC,KAAK,WAAW;AACjG,cAAI,CAAC,WAAW;AACZ,mBAAO,EAAE,SAAS,MAAM;AAAA,UAC5B;AAEA,gBAAM,WAAW,MAAM,QAAQ,aAAa,qBAAqB,EAAE,OAAO,EAAE,CAAC;AAE7E,mBAAS,IAAI,GAAG,KAAK,OAAO,KAAK;AAC7B,kBAAM,MAAM,GAAG;AAEf,kBAAM,KAAK,UAAU;AAErB,kBAAM,SAAS,OAAO;AAAA,cAClB,OAAQ,IAAI,QAAS;AAAA,cACrB,OAAO,SAAS,CAAC,OAAO,KAAK;AAAA,YACjC,CAAC;AAAA,UACL;AAEA,gBAAM,SAAS,MAAM;AAErB,iBAAO,EAAE,SAAS,KAAK;AAAA,QAC3B;AAAA,MACJ;AAAA,IACJ;AACA,WAAO;AAAA,EACX;AAAA,EAEA,MAAyB,YAAY,SAAmD;AACpF,UAAM,UAAU,MAAM,KAAK,QAAQ,gBAAgB;AACnD,YAAQ,gBAAgB,QAAQ,SAAS,CAAC;AAE1C,eAAW,UAAU,SAAS;AAC1B,cAAQ,UAAU;AAAA,QACd,IAAI,OAAO;AAAA,QACX,YAAY,OAAO,OAAO;AAAA,QAC1B,MAAM;AAAA,UACF,UAAU,OAAO;AAAA,UACjB,UAAU;AAAA,QACd;AAAA,QAEA,SAAS;AAAA,MACb,CAAC;AAED,YAAM,MAAM,GAAG;AAAA,IACnB;AAEA,YAAQ,UAAU;AAAA,MACd,IAAI;AAAA,MACJ,MAAM;AAAA,MACN,SAAS;AAAA,IACb,CAAC;AAAA,EACL;AAAA,EAEA,MAAc,UAAU,MAA8B;AAClD,UAAM,KAAK,KAAK,IAAI;AACpB,UAAM,KAAK,UAAU,EAAE;AACvB,UAAM,KAAK,QAAQ,aAAa,IAAI;AAAA,MAChC,MAAM;AAAA,MACN,QAAQ;AAAA,QACJ,MAAM,sBAAQ,UAAU,EAAE;AAAA,QAC1B,MAAM;AAAA,MACV;AAAA,MACA,QAAQ;AAAA,QACJ,UAAM,+BAAW;AAAA,MACrB;AAAA,IACJ,CAAC;AAAA,EACL;AACJ;AAEA,SAAS,MAAM,IAA2B;AACtC,SAAO,IAAI,QAAQ,aAAW,WAAW,SAAS,EAAE,CAAC;AACzD;",
  "names": ["_a"]
}
